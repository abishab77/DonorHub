<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="sign.css">

</head>

<body>
  <div class="form-container">
    <p class="title">Login</p>
    <form class="form" id="login-form">
      <div class="input-group">
        <label for="email">Email</label>
        <input placeholder="Enter your email" id="email" name="email" type="email" />

        <label for="password">Password</label>
        <input placeholder="Enter your password" id="password" name="password" type="password" />
      </div>
      <button style="margin-top:6%;" class="button" type="submit">Login</button>
    </form>
    <div class="social-message">
      <div class="line"></div>
      <p class="message">Don't have an account?<a href="signup.html">Sign up</a></p>
      <p class="message"><a href="/forgotPassword.html">Forgot password?</a></p>
      <div class="line"></div>
    </div>
  </div>
  <script src="/config.js"></script>
  <script>

    document.addEventListener("DOMContentLoaded", () => {
      const loginForm = document.getElementById('login-form');

      const collegeEmailPattern = /@mcc\.edu\.in$/;
      const passwordPattern = /^(?=.[a-z])(?=.[A-Z])(?=.\d)(?=.[@$!%?&])[A-Za-z\d@$!%?&]{8,}$/;

      function showError(input, message) {
        const error = document.createElement("div");
        error.className = "error-message";
        error.style.color = "red";
        error.style.fontSize = "0.85rem";
        error.style.marginTop = "4px";
        error.innerText = message;
        input.classList.add("input-error");
        input.parentNode.insertBefore(error, input.nextSibling);
      }

      function clearErrors() {
        document.querySelectorAll(".error-message").forEach(el => el.remove());
        document.querySelectorAll(".input-error").forEach(el => el.classList.remove("input-error"));
      }

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        clearErrors();

        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const email = emailInput.value.trim();
        const password = passwordInput.value;

        let isValid = true;

        if (!collegeEmailPattern.test(email)) {
          showError(emailInput, "Please enter a valid college email ");
          isValid = false;
        }


        if (!isValid) return;

        if (email === 'admin@mcc.edu.in' && password === 'Admin@1234') {
          sessionStorage.setItem('admin_id', '1');
          window.location.href = 'index.html';
          return;
        }


        try {
          const response = await fetch(`${window.API_URL}/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();
          if (response.ok && data.user_id) {
            sessionStorage.setItem('user_id', data.user_id);
            alert('Login successful! User ID saved in session.');
            window.location.href = 'index.html';
          } else {
            alert(data.message || 'Login failed. Please try again.');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');
        }
      });

      document.querySelectorAll(".form-input, input[type='file'], select").forEach(input => {
        input.addEventListener("input", removeError);
        input.addEventListener("change", removeError);

        function removeError(e) {
          const el = e.target;
          el.classList.remove("input-error");
          const errorMsg = el.parentNode.querySelector(".error-message");
          if (errorMsg) {
            errorMsg.remove();
          }
        }
      });
    });

  </script>

</body>

</html>