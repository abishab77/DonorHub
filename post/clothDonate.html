<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloth Donation</title>
    <link rel="stylesheet" href="request.css">
    <link rel="stylesheet" href="post.css">
    <script src="feed.js"></script>
    <style>
        .card-title {
            color: white
        }

        .subtitle {
            color: white
        }
    </style>
</head>

<body>
    <div id="clothDonationForm" class="hidden min-h-screen">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Cloth Donation Post</h2>
                <p class="subtitle">Share details about clothing donations to help those in need</p>
            </div>
            <div class="card-content">
                <form id="clothForm" class="post-form">
                    <div class="form-group">
                        <label for="title" class="form-label">Title</label>
                        <input id="title" type="text" class="form-input" placeholder="Enter request title">
                    </div>

                    <div class="form-group">
                        <label for="photoUpload" class="form-label">Cloth Photo</label>
                        <input type="file" id="photoUpload" accept="image/*">
                    </div>

                    <div class="form-group">
                        <label for="clothType" class="form-label">Type of Clothes</label>
                        <select id="clothType" class="form-input">
                            <option value="">Select cloth type</option>
                            <option value="shirts">Shirts</option>
                            <option value="pants">Pants</option>
                            <option value="dresses">Dresses</option>
                            <option value="winter">Winter Wear</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="clothQuantity" class="form-label">Quantity of Clothes</label>
                        <input type="text" id="clothQuantity" class="form-input" placeholder="E.g., 5 shirts, 3 pants">
                    </div>

                    <div class="form-group">
                        <label for="clothCondition" class="form-label">Condition of Clothes</label>
                        <select id="clothCondition" class="form-input">
                            <option value="">Select condition</option>
                            <option value="new">New with tags</option>
                            <option value="like_new">Like new</option>
                            <option value="gently_used">Gently used</option>
                            <option value="well_used">Well used but wearable</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="clothSize" class="form-label">Size Range</label>
                        <select id="clothSize" class="form-input">
                            <option value="">Select size</option>
                            <optgroup label="Kids Sizes">
                                <option value="0-2">0-2 Years</option>
                                <option value="2-4">2-4 Years</option>
                                <option value="4-6">4-6 Years</option>
                                <option value="6-8">6-8 Years</option>
                                <option value="8-10">8-10 Years</option>
                                <option value="10-12">10-12 Years</option>
                                <option value="12-14">12-14 Years</option>
                            </optgroup>
                            <optgroup label="Adult Sizes">
                                <option value="xs">XS</option>
                                <option value="s">S</option>
                                <option value="m">M</option>
                                <option value="l">L</option>
                                <option value="xl">XL</option>
                                <option value="xxl">XXL</option>
                                <option value="mixed">Mixed Sizes</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Person Photo -->


                    <div class="form-group">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" id="location" class="form-input" placeholder="Enter location or landmark">
                    </div>

                    <div class="form-group">
                        <label for="contactDetails" class="form-label">Contact Details</label>
                        <input type="text" id="contactDetails" class="form-input"
                            placeholder="Enter name, phone or email">
                    </div>

                    <div class="form-group">
                        <label for="deliveryOptions" class="form-label">Delivery Options</label>
                        <select id="deliveryOptions" class="form-input">
                            <option value="">Select delivery option</option>
                            <option value="donor_delivery">I can deliver</option>
                            <option value="recipient_pickup">Pickup required(Volunteer Required)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pickupTiming" class="form-label">Pickup/Delivery Timing</label>
                        <div class="time-range">
                            <input type="time" id="startTime" class="form-input">
                            <span>to</span>
                            <input type="time" id="endTime" class="form-input">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" id="submitClothDonation" class="submit-button">Submit Donation
                            Post</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="../config.js"></script>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById("clothForm").addEventListener("submit", async function (event) {
                event.preventDefault();
                let isValid = true;


                document.querySelectorAll(".error-message").forEach(el => el.remove());
                document.querySelectorAll(".error-border").forEach(el => el.classList.remove("error-border"));

                function showError(element, message) {
                    const error = document.createElement("div");
                    error.className = "error-message";
                    error.style.color = "red";
                    error.style.fontSize = "0.9rem";
                    error.innerText = message;
                    element.classList.add("error-border");
                    element.parentNode.appendChild(error);
                }

                const title = document.getElementById("title").value.trim();
                if (title.length < 3 || title.length > 50) {
                    showError(document.getElementById("title"), "Title must be between 3 and 50 characters.");
                    isValid = false;
                }

                const photo = document.getElementById("photoUpload").files[0];
                if (!photo) {
                    showError(document.getElementById("photoUpload"), "Please upload a photo of the food.");
                    isValid = false;
                } else if (!["image/jpeg", "image/png", "image/jpg"].includes(photo.type)) {
                    showError(document.getElementById("photoUpload"), "Only JPG or PNG images are allowed.");
                    isValid = false;
                }

                const clothType = document.getElementById("clothType").value;
                if (!clothType) {
                    showError(document.getElementById("clothType"), "Please select a cloth type.");
                    isValid = false;
                }

                const clothQuantity = document.getElementById("clothQuantity").value.trim();
                if (clothQuantity.length < 1) {
                    showError(document.getElementById("clothQuantity"), "Please enter quantity of clothes.");
                    isValid = false;
                }

                const clothCondition = document.getElementById("clothCondition").value;
                if (!clothCondition) {
                    showError(document.getElementById("clothCondition"), "Please select condition of clothes.");
                    isValid = false;
                }

                const clothSize = document.getElementById("clothSize").value;
                if (!clothSize) {
                    showError(document.getElementById("clothSize"), "Please select size range.");
                    isValid = false;
                }

                const location = document.getElementById("location").value.trim();
                if (!location) {
                    showError(document.getElementById("location"), "Please enter a location.");
                    isValid = false;
                }

                const contact = document.getElementById("contactDetails").value.trim();
                if (!/^\d{10}$/.test(contact)) {
                    showError(document.getElementById("contactDetails"), "Enter a valid 10-digit phone number.");
                    isValid = false;
                }

                const deliveryOption = document.getElementById("deliveryOptions").value;
                if (!deliveryOption) {
                    showError(document.getElementById("deliveryOptions"), "Please select a delivery option.");
                    isValid = false;
                }

                const startTime = document.getElementById("startTime").value;
                const endTime = document.getElementById("endTime").value;

                if (!startTime || !endTime) {
                    showError(document.getElementById("startTime"), "Please select both start and end time.");
                    isValid = false;
                } else {
                    const getMinutes = (timeStr) => {
                        const [hours, minutes] = timeStr.split(':').map(Number);
                        return hours * 60 + minutes;
                    };

                    const startMinutes = getMinutes(startTime);
                    const endMinutes = getMinutes(endTime);

                    if (startMinutes >= endMinutes) {
                        showError(document.getElementById("endTime"), "End time must be after start time.");
                        isValid = false;
                    }
                }

                // Stop if invalid
                if (!isValid) {
                    return;
                }

                const formData = new FormData();
                formData.append("title", document.getElementById("title").value);
                formData.append("clothPhoto", document.getElementById("photoUpload").files[0]);
                formData.append("clothType", document.getElementById("clothType").value);
                formData.append("clothQuantity", document.getElementById("clothQuantity").value);
                formData.append("clothCondition", document.getElementById("clothCondition").value);
                formData.append("clothSize", document.getElementById("clothSize").value);
                formData.append("location", document.getElementById("location").value);
                formData.append("contactDetails", document.getElementById("contactDetails").value);
                formData.append("deliveryOptions", document.getElementById("deliveryOptions").value);
                formData.append("startTime", document.getElementById("startTime").value);
                formData.append("endTime", document.getElementById("endTime").value);
                const userId = sessionStorage.getItem("user_id");

                if (userId) {
                    formData.append("user_id", userId);
                } else {
                    alert("User session expired. Please log in again.");
                    return;
                }

                const response = await fetch(`${window.API_URL}/submit-cloth-donate`, {
                    method: "POST",
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    alert("Cloth donation posted successfully!");
                    window.location.href = "/post/feed.html";

                } else {
                    alert("Error: " + result.message);
                }
            });


            document.getElementById("clothForm").addEventListener("submit", function (e) {
                e.preventDefault();

            });
            document.querySelectorAll(".form-input, input[type='file'], select").forEach(input => {
                input.addEventListener("input", removeError);
                input.addEventListener("change", removeError);

                function removeError(e) {
                    const el = e.target;
                    el.classList.remove("error-border");
                    const errorMsg = el.parentNode.querySelector(".error-message");
                    if (errorMsg) {
                        errorMsg.remove();
                    }
                }
            });



        });
    </script>
</body>

</html>