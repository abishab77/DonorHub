<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloth Request</title>
    <link rel="stylesheet" href="request.css">
    <link rel="stylesheet" href="post.css">
    <script src="feed.js"></script>
    <style>
        .card-title {
            color: white
        }

        .subtitle {
            color: white
        }
    </style>
</head>

<body>
    <div id="clothRequestForm" class="hidden min-h-screen">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Clothing Donation Request</h2>
                <p class="subtitle">Request clothing for those in need</p>
            </div>
            <div class="card-content">
                <form id="clothForm" class="post-form">
                    <div class="form-group">
                        <label for="title" class="form-label">Title</label>
                        <input id="title" type="text" class="form-input" placeholder="Enter request title">
                    </div>

                    <div class="form-group">
                        <label for="photo" class="form-label">Photo</label>
                        <input type="file" id="photo" accept="image/*" />
                    </div>

                    <div class="form-group">
                        <label for="recipientCount" class="form-label">Number of Recipients</label>
                        <input type="number" id="recipientCount" class="form-input"
                            placeholder="Enter number of individuals/families">
                    </div>

                    <div class="form-group">
                        <label for="ageGroup" class="form-label">Age Group of Recipients</label>
                        <select id="ageGroup" class="form-input">
                            <option value="">Select Age Group</option>
                            <option value="children">Children (0-12)</option>
                            <option value="teenagers">Teenagers (13-18)</option>
                            <option value="adults">Adults (19-60)</option>
                            <option value="elderly">Elderly (60+)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="recipientGender" class="form-label">Gender of Recipients</label>
                        <select id="recipientGender" class="form-input">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="location" class="form-label">Location/Address</label>
                        <input type="text" id="location" class="form-input" placeholder="Enter address or landmark">
                    </div>

                    <div class="form-group">
                        <label for="contactDetails" class="form-label">Contact Details</label>
                        <input type="text" id="contactDetails" class="form-input" placeholder="Enter phone number">
                    </div>

                    <div class="form-group">
                        <label for="needReason" class="form-label">Reason for Request</label>
                        <select id="needReason" class="form-input">
                            <option value="">Select Reason</option>
                            <option value="disaster-relief">Disaster Relief</option>
                            <option value="economic-hardship">Economic Hardship</option>
                            <option value="refugee-support">Refugee Support</option>
                            <option value="community-aid">Community Aid</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="deliveryOptions" class="form-label">Delivery Options</label>
                        <select id="deliveryOptions" class="form-input">
                            <option value="">Select delivery option</option>
                            <option value="donor_delivery">I can deliver</option>
                            <option value="recipient_pickup">Pickup required(Volunteer Required)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="deadlineDate" class="form-label">Required Before (Date)</label>
                        <input type="date" id="deadlineDate" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="deadlineTime" class="form-label">Required Before (Time)</label>
                        <input type="time" id="deadlineTime" class="form-input">
                    </div>

                    <div class="form-actions">
                        <button type="submit" id="submitClothRequest" class="submit-button">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="../config.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            document.getElementById("clothForm").addEventListener("submit", async function (event) {
                event.preventDefault();

                const data = {
                    title: document.getElementById("title").value,
                    recipientCount: document.getElementById("recipientCount").value,
                    ageGroup: document.getElementById("ageGroup").value,
                    recipientGender: document.getElementById("recipientGender").value,
                    location: document.getElementById("location").value,
                    contactDetails: document.getElementById("contactDetails").value,
                    needReason: document.getElementById("needReason").value,
                    deliveryOptions: document.getElementById("deliveryOptions").value,
                    deadlineDate: document.getElementById("deadlineDate").value,
                    deadlineTime: document.getElementById("deadlineTime").value
                };
                const userId = sessionStorage.getItem("user_id");

                if (userId) {
                    data.user_id = userId;
                } else {
                    alert("User session expired. Please log in again.");
                    return;
                }

                const response = await fetch(`${window.API_URL}/submit-cloth-request`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (response.ok) {
                    alert("Cloth request submitted successfully!");
                    window.location.href = "/post/feed.html";
                } else {
                    alert("Error: " + result.message);
                }
            });

            document.getElementById("clothForm").addEventListener("submit", function (e) {
                e.preventDefault();
                let isValid = true;

                document.querySelectorAll(".error-message").forEach(el => el.remove());
                document.querySelectorAll(".error-border").forEach(el => el.classList.remove("error-border"));

                function showError(element, message) {
                    const error = document.createElement("div");
                    error.className = "error-message";
                    error.style.color = "red";
                    error.style.fontSize = "0.9rem";
                    error.innerText = message;
                    element.classList.add("error-border");
                    element.parentNode.appendChild(error);
                }


                const title = document.getElementById("title").value.trim();
                if (title.length < 3 || title.length > 50) {
                    showError(document.getElementById("title"), "Title must be between 3 and 50 characters.");
                    isValid = false;
                }


                const photo = document.getElementById("photo").files[0];
                if (!photo) {
                    showError(document.getElementById("photo"), "Please upload a photo.");
                    isValid = false;
                } else if (!["image/jpeg", "image/png", "image/jpg"].includes(photo.type)) {
                    showError(document.getElementById("photo"), "Only JPG or PNG images are allowed.");
                    isValid = false;
                }


                const count = document.getElementById("recipientCount").value.trim();
                if (count === "" || isNaN(count) || parseInt(count) <= 0) {
                    showError(document.getElementById("recipientCount"), "Enter a valid number greater than 0.");
                    isValid = false;
                }


                const ageGroup = document.getElementById("ageGroup").value;
                if (!ageGroup) {
                    showError(document.getElementById("ageGroup"), "Please select an age group.");
                    isValid = false;
                }


                const gender = document.getElementById("recipientGender").value;
                if (!gender) {
                    showError(document.getElementById("recipientGender"), "Please select a gender group.");
                    isValid = false;
                }


                const location = document.getElementById("location").value.trim();
                if (!location) {
                    showError(document.getElementById("location"), "Please enter a location.");
                    isValid = false;
                }


                const contact = document.getElementById("contactDetails").value.trim();
                if (!/^\d{10}$/.test(contact)) {
                    showError(document.getElementById("contactDetails"), "Enter a valid 10-digit phone number.");
                    isValid = false;
                }


                const reason = document.getElementById("needReason").value;
                if (!reason) {
                    showError(document.getElementById("needReason"), "Please select a reason for request.");
                    isValid = false;
                }


                const delivery = document.getElementById("deliveryOptions").value;
                if (!delivery) {
                    showError(document.getElementById("deliveryOptions"), "Please select a delivery option.");
                    isValid = false;
                }
                const deadlineDate = document.getElementById("deadlineDate").value;
                const today = new Date().toISOString().split("T")[0];
                if (!deadlineDate || deadlineDate < today) {
                    showError(document.getElementById("deadlineDate"), "Please select a valid future date.");
                    isValid = false;
                }


                const deadlineTime = document.getElementById("deadlineTime").value;
                if (!deadlineTime) {
                    showError(document.getElementById("deadlineTime"), "Please enter the deadline time.");
                    isValid = false;
                }

                if (isValid) {
                    alert("Cloth request submitted successfully!");

                }
            });


            document.querySelectorAll(".form-input, input[type='file'], select").forEach(input => {
                input.addEventListener("input", removeError);
                input.addEventListener("change", removeError);

                function removeError(e) {
                    const el = e.target;
                    el.classList.remove("error-border");
                    const errorMsg = el.parentNode.querySelector(".error-message");
                    if (errorMsg) {
                        errorMsg.remove();
                    }
                }
            });



        });
    </script>
</body>

</html>